<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Twitch follower counter</title>

  <style>
    @font-face {
      font-family: "Druk Wide Cy Web";
      src: url("Druk Wide Cy Web Bold Regular.woff2") format("woff2"),
           url("Druk Wide Cy Web Bold Regular.woff")  format("woff");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
  </style>

  <style>
    :root {
      --anim-duration: 0.35s;
    }
    html,body {
      margin:0; padding:0;
      background: transparent;           /* полностью прозрачный фон */
      overflow:hidden;
    }
    #counter-wrapper{
      position:relative;
      display:inline-block;
      overflow:hidden;                  /* прячет выезжающие цифры */
    }
    .counter-text{
      font-family:"Druk Wide Cy Web",sans-serif;
      font-size:10vw;                   /* подгоните под OBS при желании */
      line-height:1;
      color:#ffffff;
      white-space:nowrap;
      text-shadow:
        0 0 6px rgba(0,0,0,.9),
        0 0 12px rgba(0,0,0,.8),
        0 0 18px rgba(0,0,0,.7);
      will-change:transform;
      font-variant-numeric:tabular-nums; /* если гарнитура поддерживает */
    }

    /* Ключевые кадры */
    @keyframes slide-up-out   { to { transform:translateY(-100%); opacity:0; } }
    @keyframes slide-up-in    { from{ transform:translateY(100%);} to{ transform:translateY(0);} }
    @keyframes slide-down-out { to { transform:translateY(100%);  opacity:0; } }
    @keyframes slide-down-in  { from{ transform:translateY(-100%);}to{ transform:translateY(0);} }

    .anim-up-out   { animation:slide-up-out   var(--anim-duration) ease forwards; }
    .anim-up-in    { animation:slide-up-in    var(--anim-duration) ease forwards; }
    .anim-down-out { animation:slide-down-out var(--anim-duration) ease forwards; }
    .anim-down-in  { animation:slide-down-in  var(--anim-duration) ease forwards; }
  </style>
</head>
<body>
  <div id="counter-wrapper">
    <div id="counter" class="counter-text">---/----</div>
  </div>

  <script>
    const userLogin          = "lildrey999";
    const refreshIntervalMs  = 15_000;       // 15 секунд
    const decapiUrl          = `https://r.decapi.me/twitch/followcount/${userLogin}`;

    const wrapper   = document.getElementById("counter-wrapper");
    let   currentEl = document.getElementById("counter");
    let   current   = null;                  // предыдущее число

    /* запрашиваем число у r.decapi.me */
    async function fetchFollowerCount(){
      try{
        const r = await fetch(decapiUrl,{cache:"no-store"});
        const txt = await r.text();
        return parseInt(txt.trim(),10);
      }catch(e){
        console.error("DecAPI error:",e);
        return null;
      }
    }

    /* формат "текущее/следующее кратное 100" */
    function format(count){
      const next = Math.ceil((count+1)/100)*100;
      return `${count}/${next}`;
    }

    /* анимируем смену числа: всё смещение одной строкой */
    function animateChange(newText, increment){
      const outgoing = currentEl;

      /* фиксируем текущую ширину, чтобы контейнер не «сжимался» */
      const w = outgoing.offsetWidth;
      wrapper.style.width = w + "px";

      const incoming = document.createElement("div");
      incoming.className = `counter-text ${increment ? "anim-up-in" : "anim-down-in"}`;
      incoming.textContent = newText;
      incoming.style.position = "absolute";
      incoming.style.left = 0;
      incoming.style.top  = 0;

      outgoing.classList.add(increment ? "anim-up-out" : "anim-down-out");
      wrapper.appendChild(incoming);
      currentEl = incoming;

      outgoing.addEventListener("animationend", () => {
        outgoing.remove();
        wrapper.style.width = "";         // снимаем фикс
      }, { once:true });
    }

    /* получаем первое значение + ставим интервал */
    async function init(){
      const first = await fetchFollowerCount();
      if(first!=null){
        current = first;
        currentEl.textContent = format(first);
      }
      setInterval(updateCount, refreshIntervalMs);
    }

    async function updateCount(){
      const cnt = await fetchFollowerCount();
      if(cnt==null || cnt===current) return;

      const inc = cnt > current;
      animateChange(format(cnt), inc);
      current = cnt;
    }

    init();
  </script>
</body>
</html>
