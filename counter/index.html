<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Twitch follower counter</title>

  <style>
    @font-face {
      font-family: "Druk Wide Cy Web";
      src: url("Druk Wide Cy Web Bold Regular.woff2") format("woff2"),
           url("Druk Wide Cy Web Bold Regular.woff")  format("woff");
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    /* Layout */
    html,body{margin:0;padding:0;background:transparent;overflow:hidden}
    body{display:flex;align-items:center;justify-content:center;height:100%}

    /* Wrapper keeps element positioned; overflow visible so shadow не обрезается */
    #counter-wrapper{position:relative;display:inline-block}

    .counter-text{
      font-family:"Druk Wide Cy Web",sans-serif;
      font-size:10vw;
      line-height:2;
      white-space:nowrap;
      color:#fff;
      text-shadow:0 0 6px rgba(0,0,0,.9),0 0 12px rgba(0,0,0,.8),0 0 18px rgba(0,0,0,.7);
      will-change:transform;
      font-variant-numeric:tabular-nums;
    }

    /* Animations */
    @keyframes slide-up-out{to{transform:translateY(-100%);opacity:0}}
    @keyframes slide-up-in{from{transform:translateY(100%)}to{transform:translateY(0)}}
    @keyframes slide-down-out{to{transform:translateY(100%);opacity:0}}
    @keyframes slide-down-in{from{transform:translateY(-100%)}to{transform:translateY(0)}}

    .anim-up-out{animation:slide-up-out .3s ease forwards}
    .anim-up-in{animation:slide-up-in .3s ease forwards}
    .anim-down-out{animation:slide-down-out .3s ease forwards}
    .anim-down-in{animation:slide-down-in .3s ease forwards}
  </style>
</head>
<body>
  <div id="counter-wrapper">
    <div id="counter" class="counter-text">--/--</div>
  </div>

  <script>
    const userLogin = "lildrey999";
    const refreshIntervalMs = 100; // 100 мс
    const apiUrlBase = `https://decapi.me/twitch/followcount/${userLogin}`;

    const wrapper = document.getElementById("counter-wrapper");
    let currentEl = document.getElementById("counter");
    let prevCount = null;

    async function fetchFollowerCount(){
      try{
        // добавляем одноразовый query‑param, чтобы браузер точно не кешировал
        const url = `${apiUrlBase}?_=${Date.now()}`;
        const resp = await fetch(url,{cache:"no-store"});
        const txt = await resp.text();
        return parseInt(txt.trim(),10);
      }catch(e){
        console.error(e);
        return null;
      }
    }
    }

    function formatCounter(cnt){
      if(cnt===null) return "--/--";
      const next = cnt%100===0?cnt+100:Math.ceil(cnt/100)*100;
      return `${cnt}/${next}`;
    }

    function animateChange(newText, increment){
      const outgoing = currentEl;
      const incoming = document.createElement("div");
      incoming.className = `counter-text ${increment?"anim-up-in":"anim-down-in"}`;
      incoming.textContent = newText;
      incoming.style.position="absolute";
      incoming.style.left=0;
      incoming.style.top=0;

      outgoing.classList.add(increment?"anim-up-out":"anim-down-out");

      wrapper.appendChild(incoming);
      currentEl = incoming;

      outgoing.addEventListener("animationend",()=>{
        outgoing.remove();
      },{once:true});
    }

    async function update(){
      const cnt = await fetchFollowerCount();
      if(cnt===null) return;
      const formatted = formatCounter(cnt);

      if(prevCount===null){
        currentEl.textContent = formatted;
      }else if(cnt!==prevCount){
        animateChange(formatted,cnt>prevCount);
      }
      prevCount = cnt;
    }

    update();
    setInterval(update,refreshIntervalMs);
  </script>
</body>
</html>
